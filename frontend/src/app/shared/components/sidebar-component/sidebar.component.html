<!-- Overlay mobile -->
<div
  class="sidebar-overlay"
  *ngIf="isMobile && mobileOpen"
  (click)="toggleSidebar()">
</div>

<!-- Toggle Button - Positionné à droite -->
<button
  class="sidebar-toggle-btn"
  (click)="toggleSidebar()"
  [class.expanded]="isExpanded || mobileOpen"
  [class.collapsed]="!isExpanded && !mobileOpen"
  [attr.aria-label]="isExpanded || mobileOpen ? 'Fermer le menu' : 'Ouvrir le menu'">
  <span class="toggle-icon">
    <span></span>
    <span></span>
    <span></span>
  </span>
</button>

<!-- Sidebar -->
<aside
  class="sidebar"
  [class.collapsed]="!isExpanded && !isMobile"
  [class.mobile-hidden]="isMobile && !mobileOpen"
  [class.mobile-visible]="isMobile && mobileOpen">

  <!-- Header -->
  <div class="sidebar-header">
    <div class="logo">
      <div class="logo-icon">
        <svg width="28" height="28" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="8" fill="white" fill-opacity="0.2"/>
          <path d="M16 7L23 13.5H9L16 7Z" fill="white"/>
          <rect x="9" y="13.5" width="14" height="11.5" rx="1.5" fill="white"/>
          <rect x="13" y="17" width="6" height="5" rx="0.5" fill="#059669"/>
        </svg>
      </div>
      <span class="logo-text" *ngIf="isExpanded || isMobile">Commercialiseo</span>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="sidebar-nav">
    <ul class="sidebar-menu">
      <li
        *ngFor="let item of menu"
        class="sidebar-item"
        [class.has-children]="item.children && item.children.length > 0">

        <!-- Lien simple (sans enfants) -->
        <a
        *ngIf="!item.children || item.children.length === 0"
        [routerLink]="item.url"
        class="sidebar-link"
        routerLinkActive="active"
        [title]="(!isExpanded && !isMobile) ? item.name : ''">
        <i [class]="item.icon" class="sidebar-icon"></i>
        <span class="sidebar-text" *ngIf="isExpanded || isMobile">{{ item.name }}</span>
        <span class="tooltip" *ngIf="!isExpanded && !isMobile">{{ item.name }}</span>
        </a>

        <!-- Lien avec sous-menu -->
        <div *ngIf="item.children && item.children.length > 0" class="sidebar-dropdown">
          <button
            class="sidebar-link sidebar-toggle"
            (click)="toggleDropdown(item.name)"
            [class.active]="isOpen(item.name)"
            [title]="(!isExpanded && !isMobile) ? item.name : ''">
            <i [class]="item.icon" class="sidebar-icon"></i>
            <span class="sidebar-text" *ngIf="isExpanded || isMobile">{{ item.name }}</span>
            <i
              class="fas fa-chevron-down dropdown-arrow"
              *ngIf="isExpanded || isMobile"
              [class.open]="isOpen(item.name)">
            </i>
            <span class="tooltip" *ngIf="!isExpanded && !isMobile">{{ item.name }}</span>
          </button>

          <!-- Sous-menu -->
          <ul class="sidebar-submenu" [class.open]="isOpen(item.name) && (isExpanded || isMobile)">
            <li *ngFor="let child of item.children" class="sidebar-subitem">
              <a
              [routerLink]="child.url"
              class="sidebar-sublink"
              routerLinkActive="active">
              <i [class]="child.icon" class="sidebar-icon"></i>
              <span class="sidebar-text">{{ child.name }}</span>
              </a>
            </li>
          </ul>
        </div>

      </li>
    </ul>
  </nav>

  <!-- Footer avec déconnexion -->
  <div class="sidebar-footer" *ngIf="userConnected && userConnected.email">
    <div class="user-section" *ngIf="isExpanded || isMobile">
      <div class="user-avatar">
        {{ getUserInitials() }}
      </div>
      <div class="user-details">
        <span class="user-name">{{ userConnected.username || userConnected.email }}</span>
        <span class="user-role">{{ userConnected.role }}</span>
      </div>
    </div>

    <button class="logout-btn" (click)="logout()" [title]="(!isExpanded && !isMobile) ? 'Déconnexion' : ''">
      <i class="fas fa-sign-out-alt logout-icon"></i>
      <span *ngIf="isExpanded || isMobile">Déconnexion</span>
      <span class="tooltip" *ngIf="!isExpanded && !isMobile">Déconnexion</span>
    </button>
  </div>
</aside>
